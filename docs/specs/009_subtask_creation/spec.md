---
Title: サブタスク作成機能
Status: Ready
Created: 2026-02-19
Last updated: 2026-02-19
Source: ../000_backlog/subtask-creation.md
---

# サブタスク作成機能

## Goal

親タスク配下にサブタスクを作成・管理できるようにし、作業の分解と進捗把握を一貫して行える状態を実現する。

## Non-goals

- サブタスクの多階層化（サブタスクのさらに子タスク）
- サブタスク間の依存関係（先行・後続）管理
- AIによるサブタスク自動生成
- サブタスクの手動並び替え

## User Scenarios & Testing

### Scenario 1: 親タスクにサブタスクを追加する

- Given ユーザーが既存の親タスク詳細画面を開いている
- When ユーザーがサブタスク名を入力して保存する
- Then 入力したサブタスクが親タスクに紐づいて作成される

### Scenario 2: サブタスク一覧から親タスクを認識する

- Given ユーザーがサブタスクを含むタスク一覧を表示している
- When ユーザーが任意のサブタスク項目を確認する
- Then そのサブタスクの親タスク名または親タスク詳細への導線を確認できる

### Scenario 3: 親タスク詳細でサブタスク進捗を確認する

- Given 親タスクに複数のサブタスクが登録されている
- When ユーザーが親タスク詳細画面を表示する
- Then 紐づくサブタスク一覧と進捗率（完了数/全件数および%）を確認できる

### Scenario 4: サブタスク完了状態の変更が進捗に反映される

- Given 親タスクに未完了と完了済みのサブタスクが混在している
- When ユーザーがサブタスクの完了状態を変更する
- Then 親タスク進捗率が再計算され、最新値が表示される

### Scenario 5: サブタスクなしの親タスクを確認する

- Given 親タスクにサブタスクが1件も存在しない
- When ユーザーが親タスク詳細画面を表示する
- Then 進捗率は `0/0 (0%)` と表示される

### Scenario 6: 親タスク完了条件を満たさない場合の操作

- Given 親タスクに未完了のサブタスクが1件以上存在する
- When ユーザーが親タスクを完了に変更しようとする
- Then システムは完了変更を拒否し、未完了サブタスクがあることを明示する

## Edge Cases

- 親タスクが削除された場合、紐づくサブタスクは孤立データを残さず同時に削除されること
- サブタスク作成時に親タスクIDが不正または存在しない場合、作成が拒否されること
- サブタスク名が空文字または空白のみの場合、バリデーションエラーとなること
- サブタスク完了状態の連続更新時にも、進捗率計算結果が常に最新状態と一致すること
- 親タスク配下のサブタスク件数が多い場合でも、完了率と件数表示が視認可能であること

## Requirements

### Functional Requirements

- FR-001: システムは1つのサブタスクに対して必ず1つの親タスク参照を保持する（MUST）。
- FR-002: システムは親タスク詳細画面からサブタスクを新規作成できること（MUST）。
- FR-003: システムはサブタスク一覧表示時に、親タスク名または親タスクへの遷移導線を表示する（MUST）。
- FR-004: システムは親タスク詳細画面で、紐づくサブタスク一覧を表示する（MUST）。
- FR-005: システムは親タスク進捗率を `完了サブタスク数 / 全サブタスク数` で算出し、分数と百分率を表示する（MUST）。
- FR-006: システムはサブタスクの完了・未完了変更時に親タスク進捗率を再計算する（MUST）。
- FR-007: システムはサブタスクが存在しない親タスクの進捗率を `0/0 (0%)` として扱う（MUST）。
- FR-008: システムはサブタスクが1件以上存在する場合、親タスクを「全サブタスク完了時のみ完了可能」と判定する（MUST）。
- FR-009: システムは親タスク削除時に紐づくサブタスクを同時削除する（MUST）。
- FR-010: システムは未完了サブタスクが存在する親タスクの完了操作時に、操作結果（拒否理由）をユーザーに明示する（MUST）。

### Non-functional Requirements

- NFR-001: 親タスク詳細表示時の進捗率算出は、通常利用においてユーザーに知覚可能な遅延を発生させない（SHOULD）。
- NFR-002: サブタスクと親タスクの参照整合性を保ち、孤立サブタスクを発生させない（MUST）。
- NFR-003: 親タスク詳細画面におけるサブタスク進捗表示は、通常利用で誤読を招かない視認性（分数と%の同時表示）を維持する（SHOULD）。

## Decisions

- D-001: サブタスクは単一階層（親子1段）に限定する。
- D-002: 親タスクの完了条件は、サブタスクが存在する場合に限り「全サブタスク完了」を必須とする。
- D-003: 親タスクにサブタスクが存在しない場合の進捗表示は `0/0 (0%)` とする。
- D-004: サブタスクの初期並び順は作成日時昇順とする。

## Open Questions

- Open Questionは現時点でなし。
