Title: タスク作成・編集時のエラー表示機能
Status: Ready
Created: 2026-01-15
Last updated: 2026-01-15
Source: ../000_backlog/task-validation-errors.md

## Goal
タスク作成・編集時のバリデーションエラーを適切に表示し、ユーザーが取るべきアクションを明確にする。これにより、ユーザーは入力エラーの原因を理解し、迅速に修正できるようになる。

## Non-goals
- サーバー側のエラーログ仕様の策定
- 国際化（i18n）対応
- タスク作成・編集以外のエラー表示（一覧表示、削除など）
- トースト表示ライブラリの選定・導入

## User Scenarios & Testing

1. **タスク名が空の場合のエラー表示**
   - **Given**: ユーザーがタスク作成フォームを開いている。
   - **When**: タスク名を空のまま保存ボタンを押す。
   - **Then**: タスク名フィールドの直下に「タスク名を入力してください」というエラーメッセージが表示され、保存は実行されない。入力内容は保持される。

2. **タスク名が重複している場合のエラー表示**
   - **Given**: ユーザーがタスク作成フォームでタスク名を入力している。
   - **When**: 既存のタスク名と同じ名前を入力してフィールドからフォーカスを外す。
   - **Then**: タスク名フィールドの直下に「このタスク名は既に使用されています」というエラーメッセージが表示される。

3. **エラー後の即時フィードバック**
   - **Given**: タスク名が空でエラーメッセージが表示されている。
   - **When**: ユーザーがタスク名を入力する。
   - **Then**: 入力と同時（onChange）にバリデーションが実行され、エラーメッセージが消える。

4. **複数フィールドのエラー表示**
   - **Given**: ユーザーがタスク作成フォームを開いている。
   - **When**: タスク名を空のまま、詳細に不正な値を入力して保存ボタンを押す。
   - **Then**: 各フィールドの直下にそれぞれのエラーメッセージが表示される。

5. **通信エラー時のエラー表示**
   - **Given**: ユーザーがタスクを保存しようとする。
   - **When**: ネットワークエラーで保存が失敗する。
   - **Then**: トースト/スナックバーが表示され、「保存に失敗しました。再試行してください」というメッセージと再試行ボタンが表示される。入力内容は維持される。

## Edge Cases
- **複数フィールドでエラーが同時発生**: 各フィールドの直下にそれぞれのエラーメッセージを同時に表示する。
- **同一フィールド内で複数のバリデーションエラーが発生**: 改行で区切って全てのエラーメッセージを表示する。
- **バックエンドから予期しないエラーが返される**: 汎用的なエラーメッセージを表示する。詳細は表示しない。
- **エラー表示中にフォームを閉じる**: エラー状態はクリアされ、次回フォームを開いたときは初期状態になる。
- **一意性制約エラーで代替案が提示できない**: エラーメッセージのみ表示し、ユーザーに別の名前を考えてもらう。

## Requirements

### Functional Requirements
- **FR-001**: タスク名が空の場合、フィールド直下にエラーメッセージを表示する (MUST)。
- **FR-002**: タスク名が重複している場合、フィールド直下にエラーメッセージを表示する (MUST)。
- **FR-003**: エラーメッセージは「なぜエラーなのか」と「どうすればいいか」を伝える内容である (MUST)。
- **FR-004**: エラー発生時も入力内容は保持される (MUST)。
- **FR-005**: バリデーションは初回`onBlur`で実行し、エラー後は`onChange`で即時判定する (MUST)。
- **FR-006**: 一意性制約エラーの場合、可能であれば代替案を提示する (SHOULD)。
- **FR-007**: 通信エラー時はトースト/スナックバーで通知し、再試行ボタンを表示する (MUST)。
- **FR-008**: エラーメッセージのスタイルは視覚的に明確である（赤色、アイコンなど） (SHOULD)。
- **FR-009**: バックエンドから返されるエラーはフロントエンドで整形し、ユーザーフレンドリーなメッセージに変換する (MUST)。バックエンドは構造化されたデータ（エラーコード、フィールド名など）を返す。
- **FR-010**: タスク名・タスク詳細（description）には文字数制限を設ける (MUST)。
- **FR-011**: 同一フィールド内で複数のバリデーションエラーが発生した場合、改行で区切って全てのエラーメッセージを表示する (MUST)。

### Non-functional Requirements
- **NFR-001**: エラーメッセージは[エラー表示パターンガイドライン](../../guidelines/error-display.md)に準拠する (MUST)。
- **NFR-002**: バリデーション処理はユーザーの入力を妨げない（100ms以内に完了） (SHOULD)。


