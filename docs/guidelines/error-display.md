# エラー表示パターンガイドライン

> このドキュメントはアプリケーション全体で一貫したエラー表示パターンを定義し、ユーザー体験を統一するためのガイドラインです。

## 基本方針

- **ユーザーの作業を保護する**：エラー発生時も入力内容は消去せず、復旧手段（再試行など）を提供する。
- **「なぜ」と「どうすればいいか」を伝える**：技術的な詳細ではなく、ユーザーが取るべきアクションを提示する。
- **責務を明確にする**：システム側の問題か、ユーザー入力の問題かによってUIの強度（割り込み度合い）を変える。

## スコープ外

- エラーログ（サーバーサイド）の仕様
- 国際化（i18n）対応

---

## エラー種別ごとのUIパターン

### ユーザー入力・操作起因（4xx系）

| エラー種別 | UIパターン | 備考 |
|-----------|-----------|------|
| バリデーションエラー | インライン表示（フィールド直下/横） | 初回`onBlur`、エラー後は`onChange`で即時判定 |
| 一意性制約エラー | インライン表示 + 代替案提示 | 可能な限り代替案を提示（SHOULD） |
| リソース不在（404） | エンプティステート | アプリ内コンテンツエリアに表示、一覧への導線を設置 |
| 権限不足（401/403） | プレースホルダー/ロック画面 | 理由を明示 |

### システム・通信起因（5xx / Network系）

| エラー種別 | UIパターン | 備考 |
|-----------|-----------|------|
| 致命的な障害（操作継続不能） | フルスクリーン/モーダル | ユーザー操作をブロック |
| 一時的な通信エラー | トースト/スナックバー | 再試行ボタン必須、入力内容を維持 |
| オフライン状態 | 上部バナー（常駐） | 復旧するまで表示し続ける |
| 部分的な読み込み失敗 | インライン置換（該当箇所のみ） | 親画面全体は操作可能なまま（Degraded Mode） |

### 同期・整合性エラー

| エラー種別 | UIパターン | 備考 |
|-----------|-----------|------|
| 競合エラー（Conflict） | 競合解決ダイアログ/バナー | 強制上書きを避け、ユーザーに確認させる |

---

## シナリオ別の振る舞い

### Scenario 1: バリデーションエラー
- **Given**: ユーザーがフォームに不正な値を入力している
- **When**: フィールドからフォーカスが外れる（初回）/ 値が変更される（エラー後）
- **Then**: フィールド直下にインラインでエラーメッセージが表示される

### Scenario 2: 通信エラー（保存失敗）
- **Given**: ユーザーがタスクを保存しようとする
- **When**: ネットワークエラーで保存が失敗する
- **Then**: トースト/スナックバーが表示され、入力内容は維持され、再試行ボタンが表示される

### Scenario 3: リソース不在（404）
- **Given**: ユーザーが存在しないタスクのURLにアクセスする
- **When**: サーバーから404が返る
- **Then**: アプリ内コンテンツエリアにエンプティステートが表示され、一覧への導線が提供される

### Scenario 4: オフライン状態
- **Given**: ユーザーがアプリを使用中
- **When**: ネットワーク接続が切断される
- **Then**: 上部バナーが常駐表示され、オフライン状態であることが明示される

---

## エッジケース・リスク

- 複数エラーが同時発生した場合のトースト表示順序
- オフラインバナーとトーストの重なり

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2026-01-15 | 初版作成。エラー種別ごとのUIパターンマッピングを定義 |
