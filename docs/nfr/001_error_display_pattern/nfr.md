# NFR 001: エラー表示パターンの定義

- Title: エラー表示パターンの定義
- Status: Ready
- Quality attributes (ISO/IEC 25010): Usability
- Created: 2026-01-15
- Last updated: 2026-01-15
- Source: ../000_backlog/error-display-pattern.md

## Goal
アプリケーション全体で一貫したエラー表示パターンを定義し、ユーザー体験を統一する。

## 基本方針
- **ユーザーの作業を保護する**：エラー発生時も入力内容は消去せず、復旧手段（再試行など）を提供する。
- **「なぜ」と「どうすればいいか」を伝える**：技術的な詳細ではなく、ユーザーが取るべきアクションを提示する。
- **責務を明確にする**：システム側の問題か、ユーザー入力の問題かによってUIの強度（割り込み度合い）を変える。

## Non-goals
- 既存のトースト表示ライブラリの利用方針
- エラーログ（サーバーサイド）の仕様
- 国際化（i18n）対応

## Scenarios & Testing (Given/When/Then)

### Scenario 1: バリデーションエラー
- Given: ユーザーがフォームに不正な値を入力している
  When: フィールドからフォーカスが外れる（初回）/ 値が変更される（エラー後）
  Then: フィールド直下にインラインでエラーメッセージが表示される

### Scenario 2: 通信エラー（保存失敗）
- Given: ユーザーがタスクを保存しようとする
  When: ネットワークエラーで保存が失敗する
  Then: トースト/スナックバーが表示され、入力内容は維持され、再試行ボタンが表示される

### Scenario 3: リソース不在（404）
- Given: ユーザーが存在しないタスクのURLにアクセスする
  When: サーバーから404が返る
  Then: アプリ内コンテンツエリアにエンプティステートが表示され、一覧への導線が提供される

### Scenario 4: オフライン状態
- Given: ユーザーがアプリを使用中
  When: ネットワーク接続が切断される
  Then: 上部バナーが常駐表示され、オフライン状態であることが明示される


## Edge cases / Risks
- 複数エラーが同時発生した場合のトースト表示順序
- オフラインバナーとトーストの重なり

## Requirements (NFR-001形式, MUST/SHOULD)

### ユーザー入力・操作起因（4xx系）
- NFR-001 (MUST): バリデーションエラーはインライン表示（フィールド直下/横）で提示する
- NFR-002 (MUST): バリデーションは初回`onBlur`、エラー後は`onChange`で即時判定に切り替える
- NFR-003 (SHOULD): 一意性制約エラー時は可能な限り代替案を提示する
- NFR-004 (MUST): 404エラーはアプリ内コンテンツエリアにエンプティステートで表示し、一覧への導線を設置する
- NFR-005 (MUST): 権限不足（401/403）はプレースホルダーまたはロック画面で表示し、理由を明示する

### システム・通信起因（5xx / Network系）
- NFR-006 (MUST): 致命的な障害（操作継続不能）はフルスクリーンまたはモーダルで表示する
- NFR-007 (MUST): 一時的な通信エラーはトースト/スナックバーで表示し、再試行ボタンを必ず付ける
- NFR-008 (MUST): 通信エラー時も入力内容は絶対に維持する
- NFR-009 (MUST): オフライン状態は上部バナーで継続表示し、復旧するまで常駐させる
- NFR-010 (SHOULD): 部分的な読み込み失敗は該当箇所のみインライン置換し、親画面全体は操作可能なままにする（Degraded Mode）

### 同期・整合性エラー
- NFR-011 (SHOULD): 競合エラー時は強制上書きを避け、競合解決ダイアログまたはバナーで確認させる

## Decision log (optional)
- 2026-01-15: エラー種別ごとのUIパターンマッピングを決定 / 一貫したUXとユーザー作業保護を最優先とした

## Links
- Related specs: なし
- Related issues/PRs: なし
