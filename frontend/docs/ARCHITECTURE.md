# Frontend Architecture

## レイヤー構成

```
src/
├── App.tsx          # アプリケーションエントリーポイント
├── index.tsx        # Reactルート
├── config.ts        # 定数管理
├── models/          # 型定義・ビジネスロジック
├── services/        # 外部連携・アプリケーションロジック
├── contexts/        # React Context
├── hooks/           # カスタムフック
├── layouts/         # レイアウトコンポーネント
├── pages/           # ページコンポーネント
└── components/      # UIコンポーネント
```

---

## レイヤーの役割と責務

### models/

**役割**: ドメインモデルの型定義とビジネスロジック

- ドメインモデル型、APIレスポンス型の定義
- ドメイン固有のルールや計算ロジック（例: バリデーション、変換処理）
- 技術的関心事（React、HTTP通信など）に依存しない純粋なドメイン層
- 他のレイヤーに依存しない

### services/

**役割**: 外部リソースとの連携とアプリケーションロジック

- 外部システムとの連携（APIクライアント、ストレージなど）
- ユースケースを実現するアプリケーション固有の処理
- React に依存しない純粋な JavaScript/TypeScript
- テスト時にモック可能な設計

> **ビジネスロジック vs アプリケーションロジック**
>
> - **ビジネスロジック (models)**: ドメイン固有のルール。技術に依存せず、要件から導かれる（例: 「Todoの名前は必須」）
> - **アプリケーションロジック (services)**: システムを動かすための処理。技術的な実装を含む（例: 「APIを呼んでTodoを取得する」）

### contexts/

**役割**: React Context によるグローバル状態管理

- Provider コンポーネントと Context の定義
- アプリケーション全体で共有する状態（認証、API クライアントなど）
- React に依存

### hooks/

**役割**: 再利用可能なカスタムフック

- Context からの値取得（useAuth, useApiClient など）
- 状態管理ロジックのカプセル化
- React に依存

### layouts/

**役割**: ページのレイアウト構造

- 認証ガード（PrivateLayout, PublicLayout）
- 共通ヘッダー、フッター、サイドバー
- ページ間で共通のUI構造

### pages/

**役割**: ルーティングに対応するページコンポーネント

- 各URLに対応するトップレベルコンポーネント
- ページ固有のロジックとUIの組み立て
- App.tsx のルーティングから参照される

### components/

**役割**: 再利用可能なUIコンポーネント

- 機能単位でグループ化（todo/, auth/ など）
- プレゼンテーションとロジックの両方を含む
- pages や layouts から使用される

---

## 依存関係ルール

| レイヤー       | 依存可能                            |
| -------------- | ----------------------------------- |
| **models**     | なし                                |
| **services**   | models                              |
| **contexts**   | models, services, contexts          |
| **hooks**      | models, services, contexts          |
| **layouts**    | models, hooks, contexts, components |
| **pages**      | models, hooks, contexts, components |
| **components** | models, hooks, contexts, components |
| **App.tsx**    | すべて可能                          |

---

## 依存関係図

```
          ┌──────────────────────────────────────────┐
          │                 App.tsx                  │
          │           (エントリーポイント)             │
          └───────────────────┬──────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
    ┌──────────┐       ┌──────────┐       ┌──────────┐
    │  pages   │       │ layouts  │       │ contexts │
    └────┬─────┘       └────┬─────┘       └────┬─────┘
         │                  │                  │
         └────────┬─────────┘                  │
                  ▼                            │
         ┌──────────────┐                      │
         │  components  │                      │
         └──────┬───────┘                      │
                │                              │
         ┌──────┴──────┐                       │
         ▼             ▼                       ▼
    ┌──────────┐  ┌──────────┐          ┌──────────┐
    │  hooks   │─▶│ contexts │          │ services │
    └────┬─────┘  └────┬─────┘          └────┬─────┘
         │             │                     │
         └──────┬──────┴─────────────────────┘
                ▼
         ┌──────────┐
         │  models  │
         └──────────┘
```

---

## 重要な原則

1. **models, services は React に依存しない**
   - テスト容易性のため、models, servicesからcontexts/hooksを呼ばない
   - 循環依存を防ぐ

2. **下位レイヤーは上位レイヤーを知らない**
   - models, services は React の存在を知らない

3. **components は pages を知らない**
   - 再利用性を保つため、特定のページに依存しない
